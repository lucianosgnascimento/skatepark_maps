@model IEnumerable<ProjetoPista.Model.Dtos.PistaDto>

@{ ViewData["Title"] = "Painel Administrativo 1.0"; }

<style>
    


    ul, ol {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    a {
        text-decoration: none;
        color: #777b80;
        -webkit-transition: all 0.3s;
        -moz-transition: all 0.3s;
        transition: all 0.3s;
    }

        a:focus, a:hover {
            text-decoration: none;
            color: #023981;
        }

    
    

    #map_canvas {
        width: 100%;
        height: 100%;
    }

    
</style>

<script>

        jQuery(function ($) {
            // Asynchronously Load the map API
            var script = document.createElement('script');
            script.src = "https://maps.googleapis.com/maps/api/js?key=&callback=initialize";
            document.body.appendChild(script);
        });

        function initialize() {
            var map;
            var bounds = new google.maps.LatLngBounds();
            var mapOptions = {
                mapTypeId: 'roadmap'
            };

            // Display a map on the page
            map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
            map.setTilt(45);

            // Multiple Markers

            var markers = [

                @if (ViewBag.lat != null) {
                    <text> ["EU",@ViewBag.lat.Replace(",", "."), @ViewBag.lon.Replace(",", ".")], </text>
            }
                @foreach (var item in Model)
            {
                <text>['@item.nm_pista.ToString()', @item.nr_latitude.ToString().Replace(",","."), @item.nr_longitude.ToString().Replace(",", ".")],</text>
            }

                //['Local 3', -23.630355817243128, -46.65799790278],
                //['Local 4', -23.667613848877686, -46.6719587940728]

            ];
            var infoContent = ' < div class="info_content" > ' +
            '<h3 class="info_location_name">Local 2</h3>' +
                '<p class="info_location_text">Endereço 1</p>' +
                '<p class="info_location_call"><span><i class="fa fa-phone"></i></span>(800) 123-1314</p>' +
                '<a href="#" class="btn-link">Saiba mais</a>' +
                '</div>';
            // Info Window Content
            var infoWindowContent = [
                @if (ViewBag.lat != null) {
                    <text>['<div class="info_content"><h3 class="info_location_name">Eu To aqui hehe</h3><p class="info_location_text">Mas poderia estar andando de sk8.</p><p class="info_location_call"></div>'],</text>
                }
                @foreach (var item in Model)
                {
                    <text>['<div class="info_content"> <img class="card-img-toptext-center w-100" src="~/imagensPistas/@item.nm_imagens[0]" alt="Card image cap"> <h3 class="info_location_name">@item.nm_pista.ToString()</h3> <p class="info_location_text">@item.ds_horario_funcionamento.ToString()</p> <div class="col-md-12 text-center"> <button type="button" class="btn btn-primary" name="Mais" value="@item.id_pista">Saber mais</button> <button type="button" class="btn btn-secondary" value="@item.id_pista"><i class="fa fa-arrow-up"></i> Ir </button></div></div>'],</text>
                }
                /*['<div class="info_content">' +
                    '<h3 class="info_location_name">Local 2</h3>' +
                    '<p class="info_location_text">Endereço 1</p>' +
                    '<p class="info_location_call"><span><i class="fa fa-phone"></i></span>(800) 123-1314</p>' +
                    '<a href="#" class="btn-link">Saiba mais</a>' +


                    '</div>'
                ],
                ['<div class="info_content">' +
                    '<h3 class="info_location_name">Local 3</h3>' +
                    '<p class="info_location_text">Endereço 1</p>' +
                    '<p class="info_location_call"><span><i class="fa fa-phone"></i></span>(800) 123-1112</p>' +
                    '<a href="#" class="btn-link">Saiba mais</a>' +


                    '</div>'
                ],
                ['<div class="info_content">' +
                    '<h3 class="info_location_name">Local 4</h3>' +
                    '<p class="info_location_text">Endereço 1</p>' +
                    '<p class="info_location_call"><span><i class="fa fa-phone"></i></span>(800) 123-8910</p>' +
                    '<a href="#" class="btn-link">Saiba mais</a>' +


                    '</div>'
                ]*/
            ];
            // Display multiple markers on a map
            var infoWindow = new google.maps.InfoWindow({ maxWidth: 280 }),
                marker, i;

            // Loop through our array of markers & place each one on the map
            for (i = 0; i < markers.length; i++) {
                var position = new google.maps.LatLng(markers[i][1],
                    markers[i][2], markers[i][3], markers[i][4]);
                bounds.extend(position);
                marker = new google.maps.Marker({
                    icon: {
                        //url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
                        labelOrigin: new google.maps.Point(75, 32),
                        size: new google.maps.Size(32, 32),
                        anchor: new google.maps.Point(16, 32)
                    },
                    position: position,
                    map: map,
                    title: markers[i][0]
                });

                // Allow each marker to have an info window
                google.maps.event.addListener(marker, 'mouseover', (function (marker, i) {
                    return function () {
                        infoWindow.setContent(infoWindowContent[i][0]);
                        infoWindow.open(map, marker);
                    }
                })(marker, i));

                // Automatically center the map fitting all markers on the screen
                map.fitBounds(bounds);
            }

            // Override our map zoom level once our fitBounds function runs (Make sure it only runs once)
            var tilesloadedListener = google.maps.event.addListener((map), 'tilesloaded', function (event) {
                if (@Model.Count() == 0) {
                    this.setZoom(16);
                }
                google.maps.event.removeListener(tilesloadedListener);
            });

        }

</script>


<div id="map_canvas" class="mapping"></div>
